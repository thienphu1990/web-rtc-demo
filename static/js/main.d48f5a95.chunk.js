(this.webpackJsonpwee_rtc_demo=this.webpackJsonpwee_rtc_demo||[]).push([[0],{133:function(e,n,t){e.exports=t(405)},137:function(e,n,t){},405:function(e,n,t){"use strict";t.r(n);var o=t(3),i=t.n(o),a=t(18),r=t.n(a),c=(t(137),t(74)),s=t.n(c),d=t(120),l=t(132),u=t(52),f=t(121),m=t(128),p=t(122),h=t(123);t(148);function g(){var e=Object(f.a)(["\n  display: flex;\n  width: 100%;\n  height: 100%;\n  flex-direction: column;\n  align-items: center;\n  input{\n    text-align: center;\n    margin: 8px 0;\n  }\n  .video-container{\n    display:flex;\n    position: relative;\n    width:50%;\n    #local-video{\n      position: absolute;\n      top: 0; \n      right: 0;\n      /* max-width: 100%; */\n      width: 100%;\n      z-index:1;\n    }\n    #remote-video{\n      position: absolute;\n      top: 0;\n      right: 0;\n      /* max-width: 20%; */\n      width: 100%;\n      z-index: 0;\n    }\n  }\n  .button-container{\n    display: flex;\n    flex-direction: row;\n    width:100%;\n    height: 50px;\n    margin: 20px 0;\n    justify-content:center;\n    #start, #call, #hangup, #random{\n      width: 150px;\n      height:50px;\n      border-radius: 5px;\n      background-color: #33ADFF;\n      font-weight:bold;\n      font-size: 15px;\n      color: #fff;\n      display:flex;\n      align-items:center;\n      justify-content:center;\n      margin: 0 10px;\n      :disabled{\n        background-color: #cccccc;\n      }\n    }\n  }\n  \n"]);return g=function(){return e},e}var v,b,w,x=m.a.div(g()),I={video:{width:{min:640,max:1280},height:{min:480,max:720}},audio:!1},y=h.initializeApp({apiKey:"AIzaSyB-q7FU6fQQTOShT_UbybVUBOcXHAhTILo",authDomain:"vinpearl-2f7d4.firebaseapp.com",databaseURL:"https://vinpearl-2f7d4.firebaseio.com",projectId:"vinpearl-2f7d4",storageBucket:"vinpearl-2f7d4.appspot.com",messagingSenderId:"904958325116",appId:"1:904958325116:web:e123ec52c8eea170"}),E="vinhome/videocall",O=y.database(),S=new RTCPeerConnection({iceServers:[{urls:"stun:stun.l.google.com:19302"},{urls:"stun:stun.services.mozilla.com"}]}),j=Object(p.a)(10);console.log(j);var k=null,D=!1,B=function(){Object(o.useEffect)((function(){return v=document.getElementById("local-video"),b=document.getElementById("remote-video"),document.getElementById("start"),document.getElementById("random"),document.getElementById("hangup"),w=document.getElementById("input-id"),S.addEventListener("icecandidate",B),S.addEventListener("addstream",C),function(){}}),[]);var e=Object(o.useState)(""),n=Object(u.a)(e,2),t=n[0],a=n[1],r=Object(o.useState)(!1),c=Object(u.a)(r,2),f=c[0],m=c[1],p=Object(o.useState)(!0),h=Object(u.a)(p,2),g=h[0],y=h[1],B=function(e){e.candidate?(console.log("send ice candidate"),R(JSON.stringify({ice:e.candidate}))):console.log("Sent All Ice")},C=function(e){var n=e.stream;console.log(n),v.style.zIndex=2,v.style.width="35%",b.srcObject=n,n},R=function(e){k&&O.ref(E).child(k.roomId).set(Object(l.a)({},k,{sender:j,message:e}))},z=function(e){O.ref(E).child(e).on("value",(function(e){D||(D=!0,console.log("----- Start watching firebase -----"));var n=e.val();J(n)}))},T=function(e){return new Promise((function(n){O.ref(E).child(e).once("value",(function(e){console.log("is existed room: ",e.exists()),n(e.exists())}))}))},A=function(e){return new Promise((function(n){O.ref(E).child(e).once("value",(function(e){console.log("detail room: ",e.val()),n(e.val())}))}))},J=function(e){if(e&&e.message){var n=JSON.parse(e.message);console.log("read firebase: ",e),e.sender!==j&&(void 0!==n.ice?(console.log("add ice candidate"),S.addIceCandidate(new RTCIceCandidate(n.ice))):"offer"===n.sdp.type?(console.log("read message offer"),S.setRemoteDescription(new RTCSessionDescription(n.sdp)).then((function(){return S.createAnswer()})).then((function(e){return S.setLocalDescription(e)})).then((function(){k.friendId=e.friendId,R(JSON.stringify({sdp:S.localDescription}))})).catch((function(e){console.error(e)}))):"answer"===n.sdp.type&&(console.log("read message answer"),S.setRemoteDescription(new RTCSessionDescription(n.sdp)).catch((function(e){console.error(e)}))))}},L=function(){var e=Object(d.a)(s.a.mark((function e(){var n;return s.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(m(!1),y(!1),w){e.next=4;break}return e.abrupt("return");case 4:return n=w.value,e.next=7,T(n);case 7:if(e.sent){e.next=13;break}k={ownerId:j,friendId:"",roomId:t=n,message:"",sender:j},O.ref(E).child(t).set(k),z(n),e.next=19;break;case 13:return z(n),e.next=16,A(n);case 16:(k=e.sent).friendId=j,k&&P();case 19:a(!0),U();case 21:case"end":return e.stop()}var t}),e)})));return function(){return e.apply(this,arguments)}}(),N=function(){var e;k&&(k.ownerId===j?(e=k.roomId,O.ref(E).child(e).remove()):k.roomId)},U=function(){navigator.mediaDevices.getUserMedia(I).then((function(e){return v.srcObject=e})).then((function(e){return S.addStream(e)})).catch((function(e){console.error("Error accessing media devices.",e)}))},P=function(){S.createOffer().then((function(e){return S.setLocalDescription(e)})).then((function(){return R(JSON.stringify({sdp:S.localDescription}))}))},_=function(e){var n=w.value;n&&n.length>0?m(!0):m(!1)};return i.a.createElement(x,null,i.a.createElement("p",null,"Your ID: ",j),t?i.a.createElement("p",null,"Room ID: ",k&&k.roomId):i.a.createElement("input",{type:"text",placeholder:"input room ID",id:"input-id",style:{width:"250px",height:"30px"},onChange:_}),i.a.createElement("div",{className:"button-container"},t?i.a.createElement("button",{id:"hangup",onClick:function(){return N()}},"Hang Up"):i.a.createElement(i.a.Fragment,null,i.a.createElement("button",{id:"start",onClick:function(){return L()},disabled:!f},"Start"),i.a.createElement("button",{id:"random",onClick:function(){return function(){if(w){var e=Math.floor(1e9*Math.random());w.value=e,_()}}()},disabled:!g},"Random"))),i.a.createElement("div",{className:"video-container"},i.a.createElement("video",{id:"local-video",autoPlay:!0}),i.a.createElement("video",{id:"remote-video",autoPlay:!0})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));r.a.render(i.a.createElement(i.a.StrictMode,null,i.a.createElement(B,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[133,1,2]]]);
//# sourceMappingURL=main.d48f5a95.chunk.js.map